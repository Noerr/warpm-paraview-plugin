<ServerManagerConfiguration>
  <!-- Internal readers (not directly exposed to users) -->
  <ProxyGroup name="internal_sources">
    <!-- Core WARPM Reader: Used internally by file series wrapper -->
    <Proxy class="vtkWARPMReader" name="WARPMReaderCore">
      <StringVectorProperty name="FileName"
                            command="SetFileName"
                            number_of_elements="1">
        <FileListDomain name="files"/>
      </StringVectorProperty>

      <DoubleVectorProperty information_only="1"
                            name="TimestepValues"
                            repeatable="1">
        <TimeStepsInformationHelper />
      </DoubleVectorProperty>

      <StringVectorProperty name="PointArrayInfo"
                            information_only="1">
        <ArraySelectionInformationHelper attribute_name="Point" />
      </StringVectorProperty>

      <StringVectorProperty name="PointArrayStatus"
                            command="SetPointArrayStatus"
                            number_of_elements="2"
                            repeat_command="1"
                            number_of_elements_per_command="2"
                            element_types="2 0"
                            information_property="PointArrayInfo"
                            label="Variables">
        <ArraySelectionDomain name="array_list">
          <RequiredProperties>
            <Property name="PointArrayInfo" function="ArrayList" />
          </RequiredProperties>
        </ArraySelectionDomain>
      </StringVectorProperty>
    </Proxy>

    <!-- Core Phase Space Reader: Used internally by file series wrapper -->
    <Proxy class="vtkWARPMPhaseSpaceReader" name="WARPMPhaseSpaceReaderCore">
      <StringVectorProperty name="FileName"
                            command="SetFileName"
                            number_of_elements="1">
        <FileListDomain name="files"/>
      </StringVectorProperty>

      <DoubleVectorProperty information_only="1"
                            name="TimestepValues"
                            repeatable="1">
        <TimeStepsInformationHelper />
      </DoubleVectorProperty>

      <StringVectorProperty name="PointArrayInfo"
                            information_only="1">
        <ArraySelectionInformationHelper attribute_name="Point" />
      </StringVectorProperty>

      <StringVectorProperty name="PointArrayStatus"
                            command="SetPointArrayStatus"
                            number_of_elements="2"
                            repeat_command="1"
                            number_of_elements_per_command="2"
                            element_types="2 0"
                            information_property="PointArrayInfo"
                            label="Variables">
        <ArraySelectionDomain name="array_list">
          <RequiredProperties>
            <Property name="PointArrayInfo" function="ArrayList" />
          </RequiredProperties>
        </ArraySelectionDomain>
      </StringVectorProperty>

      <IntVectorProperty name="PhysicalSliceIndices"
                         command="SetPhysicalSliceIndices"
                         number_of_elements="3"
                         default_values="0 0 0">
        <IntRangeDomain name="range" min="0" />
      </IntVectorProperty>

      <IntVectorProperty name="PhysicalNodeIndex"
                         command="SetPhysicalNodeIndex"
                         number_of_elements="1"
                         default_values="0">
        <IntRangeDomain name="range" min="0" />
      </IntVectorProperty>
    </Proxy>

  </ProxyGroup>

  <!-- Public reader proxies with file series support -->
  <ProxyGroup name="sources">
    <!-- WARPM Reader with file series support -->
    <SourceProxy name="WARPMReader"
                 class="vtkFileSeriesReader"
                 si_class="vtkSIMetaReaderProxy"
                 file_name_method="SetFileName"
                 label="WARPM Reader">
      <Documentation long_help="Reads WARPM HDF5 simulation output with high-order DG elements."
                     short_help="Read WARPM data.">
        Reads WARPM simulation output from HDF5 files. Supports:
        - Direct .h5 file loading (single file or multi-select for time series)
        - .warpm metadata files for time series (with glob patterns)
        - High-order discontinuous Galerkin elements (VTK Lagrange cells)

        For phase space (Vlasov-Maxwell) data, use the WARPM Phase Space Reader instead.
      </Documentation>

      <StringVectorProperty name="FileNameInfo"
                            command="GetCurrentFileName"
                            information_only="1">
        <SimpleStringInformationHelper />
      </StringVectorProperty>

      <StringVectorProperty name="FileName"
                            animateable="0"
                            clean_command="RemoveAllFileNames"
                            command="AddFileName"
                            information_property="FileNameInfo"
                            number_of_elements="1"
                            panel_visibility="never"
                            repeat_command="1">
        <FileListDomain name="files"/>
        <Documentation>
          Path to WARPM HDF5 file(s) (.h5) or metadata file (.warpm).
          Select multiple .h5 files for time series.
        </Documentation>
      </StringVectorProperty>

      <DoubleVectorProperty information_only="1"
                            name="TimestepValues"
                            repeatable="1">
        <TimeStepsInformationHelper />
      </DoubleVectorProperty>

      <SubProxy>
        <Proxy name="Reader"
               proxygroup="internal_sources"
               proxyname="WARPMReaderCore" />
        <ExposedProperties>
          <Property name="PointArrayInfo" />
          <Property name="PointArrayStatus" />
        </ExposedProperties>
      </SubProxy>

      <Hints>
        <ReaderFactory extensions="warpm h5"
                       file_description="WARPM HDF5 Data"/>
      </Hints>
    </SourceProxy>

    <!-- WARPM Phase Space Reader with file series support
         Uses custom vtkWARPMPhaseSpaceFileSeriesReader which subclasses
         vtkFileSeriesReader with 3 output ports instead of 1.
         See: https://discourse.paraview.org/t/file-series-support-for-custom-time-unaware-plugin/15566 -->
    <SourceProxy name="WARPMPhaseSpaceReader"
                 class="vtkWARPMPhaseSpaceFileSeriesReader"
                 si_class="vtkSIMetaReaderProxy"
                 file_name_method="SetFileName"
                 label="WARPM Phase Space Reader">
      <Documentation long_help="Reads WARPM HDF5 phase space (Vlasov-Maxwell) data with physical and velocity space outputs."
                     short_help="Read WARPM phase space data.">
        Reads WARPM phase space (Vlasov-Maxwell) simulation output from HDF5 files.
        This reader is specialized for data containing velocity-space dimensions
        (coordinates starting with 'v' or 'w').

        Output ports:
        - Port 0 (Physical Space): Physical space mesh with physical-space variables
        - Port 1 (Velocity Space): Velocity space mesh at user-specified physical location
        - Port 2 (Slice Position): Single point showing slice location in physical space

        Note: This reader only accepts files containing phase space variables.
        For physical-only data, use the standard WARPM Reader.
      </Documentation>

      <StringVectorProperty name="FileNameInfo"
                            command="GetCurrentFileName"
                            information_only="1">
        <SimpleStringInformationHelper />
      </StringVectorProperty>

      <StringVectorProperty name="FileName"
                            animateable="0"
                            clean_command="RemoveAllFileNames"
                            command="AddFileName"
                            information_property="FileNameInfo"
                            number_of_elements="1"
                            panel_visibility="never"
                            repeat_command="1">
        <FileListDomain name="files"/>
        <Documentation>
          Path to WARPM HDF5 file(s) (.h5) or metadata file (.warpm).
          Select multiple .h5 files for time series.
        </Documentation>
      </StringVectorProperty>

      <DoubleVectorProperty information_only="1"
                            name="TimestepValues"
                            repeatable="1">
        <TimeStepsInformationHelper />
      </DoubleVectorProperty>

      <SubProxy>
        <Proxy name="Reader"
               proxygroup="internal_sources"
               proxyname="WARPMPhaseSpaceReaderCore" />
        <ExposedProperties>
          <Property name="PointArrayInfo" />
          <Property name="PointArrayStatus" />
          <Property name="PhysicalSliceIndices" />
          <Property name="PhysicalNodeIndex" />
        </ExposedProperties>
      </SubProxy>

      <PropertyGroup label="Velocity Space Location" panel_visibility="default">
        <Property name="PhysicalSliceIndices" />
        <Property name="PhysicalNodeIndex" />
        <Documentation>
          Controls which physical location to extract velocity space data from.
          These settings only affect the Velocity Space output (Port 1).
        </Documentation>
      </PropertyGroup>

      <OutputPort index="0" name="Physical Space" />
      <OutputPort index="1" name="Velocity Space" />
      <OutputPort index="2" name="Slice Position" />

      <Hints>
        <ReaderFactory extensions="warpm h5"
                       file_description="WARPM Phase Space Data"/>
      </Hints>
    </SourceProxy>
  </ProxyGroup>
</ServerManagerConfiguration>
